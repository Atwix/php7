index index.html index.php;
autoindex off;

# If this block is removed, all requests for missing images will be routed to
# Magento (slow!). Instead, quickly send a 404 upon request for a missing file.
# This block also includes aggressive caching for static files.
location ~ ^/(media|skin|js)/ {
    include snippets/caching.conf;
    try_files $uri =404;
}

location / {
    try_files $uri $uri/ /index.php?$args;
}

# PHP handler
location ~ \.php$ {
    include snippets/fastcgi-php.conf;
    fastcgi_pass fastcgi_backend;
}

# Disallow access to common sensitive files
include snippets/disallow-global.conf;

# Block sensitive magento files
# These locations would be restricted by .htaccess normally
location ~ ^/app/                        { deny all; return 404; }
location ~ ^/dev/                        { deny all; return 404; }
location ~ ^/downloader/                 { deny all; return 404; }
location ~ ^/includes/                   { deny all; return 404; }
location ~ ^/lib/                        { deny all; return 404; }
location ~ ^/media/customer/             { deny all; return 404; }
location ~ ^/media/downloadable/         { deny all; return 404; }
location ~ ^/pkginfo/                    { deny all; return 404; }
location ~ ^/report/config.xml           { deny all; return 404; }
location ~ ^/shell/                      { deny all; return 404; }
location ~ ^/var/                        { deny all; return 404; }
location ~ ^/errors/*\.(xml|phtml)       { deny all; return 404; }
location = /RELEASE_NOTES.txt            { deny all; return 404; }
